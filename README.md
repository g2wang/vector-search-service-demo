# Rust Axum Vector Search API with Qdrant and Local Embedding Model 
(Used ChatGPT, DeepSeek and Claude for implementation ideas and code samples.)

This project implements a web server using **Rust**, **Axum**, **Qdrant**, and a local **all-MiniLM-L6-v2** text embedding model to store and search vectorized tips.

## 🚀 **Features**
- **Add Tip Endpoint:** Vectorizes input text and stores it in Qdrant.
- **Search Tip Endpoint:** Finds the most relevant stored tip using vector search.
- **Local Embedding Model:** Uses a local ONNX model for embeddings.
- **Thread-Safe State:** Efficiently shares model and clients across routes.
- **Long Text Handling:** split into chunks and use weighted mean.

---
## 🛠️ **Setup Instructions**
### 1. **Clone the Repository:**
```bash
git clone https://github.com/g2wang/vector-search-service-demo.git
cd vector-search-service-demo
```

### 2. **Install Dependencies:**
```bash
cargo build
# or cargo build --release
```

### 3. **Set Environment Variables:** Create a `.env` file:
```env
QDRANT_URL=http://localhost:6333
SERVER_URL=127.0.0.1:3000
```

### 4. **Prepare Embedding Model:** Place the ONNX model files in `all-MiniLM-L6-v2/`:
```
all-MiniLM-L6-v2/
 ├── onnx/model.onnx
 ├── tokenizer.json
 ├── config.json
 ├── special_tokens_map.json
 └── tokenizer_config.json
```
---
## 🚀 **Run the Server:**
```bash
cargo run
# alternatively, run the executable generated by cargo build
```
The server will start at: **http://127.0.0.1:3000**

---
## 📡 **API Endpoints:**
### 1. Add Tip (`POST /tip`)
- **Request:**
```json
{
  "text": "This is a helpful tip!"
}
```
- **Response:**
```json
{
  "status": "success"
}
```

### 2. Search Tip (`POST /search`)
- **Request:**
```json
{
  "text": "Find a tip about..."
}
```
- **Response:**
```json
[
  {
    "text": "This is a helpful tip!",
    "score": 0.98
  }
]
```
---
## 📂 **Project Structure:**
```
├── main.rs            # Main Axum server and endpoints
├── embedding.rs       # Text embedding logic
├── qdrant_util.rs     # Qdrant operations (upsert, search)
├── splitter.rs        # Text splitter utilities
├── vector_mean.rs     # Vector pooling methods
└── thread_safty.rs    # Thread-safety assertions
```
---
## 💡 **Contributing:**
Feel free to open issues or pull requests to improve this project.

## 📝 **License:** MIT License
