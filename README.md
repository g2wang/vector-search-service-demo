# Rust Axum Vector Search API with Qdrant and Local Embedding Model 
(Used ChatGPT, DeepSeek and Claude for implementation ideas and code samples.)

This project implements a web server using **Rust**, **Axum**, **Qdrant**, and a local **all-MiniLM-L6-v2** text embedding model to store and search vectorized docs.

## 🚀 **Features**
- **Add Doc Endpoint:** Vectorizes input text and stores it in Qdrant.
- **Search Doc Endpoint:** Finds the most relevant stored doc using vector search.
- **Local Embedding Model:** Uses a local ONNX model for embeddings.
- **Thread-Safe State:** Efficiently shares model and clients across routes.
- **Long Text Handling:** split into chunks and use weighted mean.

---
## 🛠️ **Setup Instructions**
### 1. **Clone the Repository:**
```bash
git clone https://github.com/g2wang/vector-search-service-demo.git
cd vector-search-service-demo
```

### 2. **Install Dependencies:**
```bash
cargo build
# or cargo build --release
```

### 3. **Set Environment Variables:** Create a `.env` file:
```env
QDRANT_URL=http://localhost:6333
SERVER_URL=127.0.0.1:3000
```

---
## 🚀 **Run the Server:**
```bash
# first start the Qdrant vector database server
./start_qdrant.sh

# then start the service
cargo run
# alternatively, run the executable generated by cargo build
```
The server will start at: **http://127.0.0.1:3000**

---
## 🚀 **Test the API Endpoints:**
```bash
./add_doc.sh
./query_doc.sh
```

---
## 📡 **API Endpoints:**
### 1. Add Doc (`POST /doc`)
- **Request:**
```json
{
  "text": "This is a helpful doc!"
}
```
- **Response:**
```json
{
  "status": "success"
}
```

### 2. Search Doc (`POST /search`)
- **Request:**
```json
{
  "text": "Find a doc about..."
}
```
- **Response:**
```json
[
  {
    "text": "This is a helpful doc!",
    "score": 0.98
  }
]
```
---
## 📂 **Project Structure:**
```
src
├── all_minilm_l6_v2
│   ├── mod.rs
│   └── models
│       ├── README.txt
│       ├── config.json
│       ├── onnx
│       │   └── model.onnx
│       ├── special_tokens_map.json
│       ├── tokenizer.json
│       └── tokenizer_config.json
├── embedding.rs
├── main.rs
├── qdrant_util.rs
├── splitter.rs
├── thread_safty.rs
└── vector_mean.rs
```
---
## 💡 **Contributing:**
Feel free to open issues or pull requests to improve this project.

## 📝 **License:** MIT License
